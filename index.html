<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Il tuo hub – link, social e documenti</title>
  <meta name="description" content="Una semplice pagina link‑in‑bio per raccogliere social, documenti scaricabili e contatti." />
  <meta name="theme-color" content="#111827" />
  <meta property="og:title" content="Il tuo hub" />
  <meta property="og:description" content="Tutti i link e i documenti in un posto solo." />
  <style>
    :root {
      --bg1: #0ea5e9; /* cyan-500 */
      --bg2: #9333ea; /* violet-600 */
      --card-bg: rgba(255,255,255,0.9);
      --text: #0f172a; /* slate-900 */
      --muted: #475569; /* slate-600 */
      --ring: rgba(14,165,233,0.45);
      --border: rgba(15,23,42,0.08);
      --success: #16a34a; /* green-600 */
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: linear-gradient(120deg, var(--bg1), var(--bg2));
      background-attachment: fixed;
      display: grid; place-items: center;
      padding: 24px;
    }
    .container {
      width: 100%; max-width: 760px;
      background: var(--card-bg);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0,0,0,0.12);
      border-radius: 24px;
      padding: 28px;
    }
    header { display: grid; grid-template-columns: auto 1fr; gap: 18px; align-items: center; }
    .avatar {
      width: 72px; height: 72px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff, #dbeafe);
      border: 2px solid var(--border);
      display: grid; place-items: center; font-weight: 700; color: #1e293b;
      object-fit: cover;
    }
    h1 { margin: 0 0 4px; font-size: clamp(1.25rem, 1.2rem + 1vw, 1.8rem); }
    .subtitle { margin: 0; color: var(--muted); }

    .section { margin-top: 24px; }
    .section h2 {
      margin: 0 0 12px; font-size: 1rem; letter-spacing: .02em; text-transform: uppercase;
      color: #111827;
    }

    .links { display: grid; gap: 10px; }
    .link-btn {
      display: flex; align-items: center; gap: 12px; text-decoration: none;
      padding: 14px 16px; border-radius: 14px; border: 1px solid var(--border);
      background: #fff; color: #0f172a; transition: transform .06s ease, box-shadow .2s ease, border-color .2s ease;
      box-shadow: 0 2px 10px rgba(0,0,0,0.04);
    }
    .link-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,0.08); border-color: var(--ring); }
    .link-btn:active { transform: translateY(0); }
    .link-btn svg { width: 22px; height: 22px; }
    .link-title { font-weight: 600; }
    .link-desc { color: var(--muted); font-size: .92rem; }

    .docs { display: grid; gap: 8px; }
    .doc-item { display: flex; align-items: center; gap: 10px; padding: 12px 14px; background: #fff; border: 1px solid var(--border); border-radius: 12px; }
    .doc-item a { color: #0f172a; text-decoration: none; font-weight: 600; }
    .doc-item small { color: var(--muted); }
    .doc-icon { width: 22px; height: 22px; }

    .events { display: grid; gap: 10px; }
    .event-card { background:#fff; border:1px solid var(--border); border-radius: 12px; padding: 12px 14px; }
    .event-when { font-weight: 600; }
    .event-where { color: var(--muted); font-size: .92rem; margin-bottom: 6px; }

    .share { display:flex; gap:8px; flex-wrap:wrap; }
    .btn {
      display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:12px;
      background:#111827; color:#fff; border:1px solid rgba(255,255,255,.08); text-decoration:none;
      box-shadow: 0 2px 10px rgba(0,0,0,.08);
    }
    .btn:focus { outline: 3px solid var(--ring); outline-offset: 2px; }

    footer { margin-top: 26px; display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .contact { color: var(--muted); }
    .badge { font-size: .82rem; color: #0ea5e9; background: #e0f2fe; border: 1px solid #bae6fd; padding: 4px 10px; border-radius: 999px; }

    .note { margin-top: 6px; color: var(--muted); font-size: .92rem; }
    .hidden { display: none; }
    .toast { position: fixed; bottom: 16px; left: 50%; transform: translateX(-50%); background:#fff; border:1px solid var(--border); border-radius:12px; padding:10px 12px; box-shadow:0 8px 20px rgba(0,0,0,.12); }
  </style>
</head>
<body>
  <main class="container" role="main">
    <header>
      <img id="avatar-img" class="avatar" src="https://votagemelli.github.io/links/assets/claudio.jpg?v=1" alt="Claudio Gemelli" onerror="this.style.display='none';document.getElementById('avatar-fallback').classList.remove('hidden')" />
      <div id="avatar-fallback" class="avatar hidden" aria-hidden="true">CG</div>
      <div>
        <h1>CLAUDIO GEMELLI</h1>
        <p class="subtitle">Ecco tutte le informazioni utili per seguire la campagna elettorale</p>
        <p class="note">Ultimo aggiornamento: <time id="last-updated" aria-live="polite">—</time></p>
      </div>
    </header>

    <section class="section" aria-labelledby="social-title">
      <h2 id="social-title">Social</h2>
      <div class="links">
        <a class="link-btn" href="https://www.instagram.com/claudio.gemelli.fdi/" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2.75" y="2.75" width="18.5" height="18.5" rx="5"/><circle cx="12" cy="12" r="4"/><circle cx="17.5" cy="6.5" r="1.2" fill="currentColor" stroke="none"/></svg>
          <div>
            <div class="link-title">Instagram</div>
            <div class="link-desc">@claudio.gemelli.fdi</div>
          </div>
        </a>
        <a class="link-btn" href="https://www.facebook.com/share/15F4udkWZwo/?mibextid=wwXIfr" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" aria-hidden="true" fill="currentColor"><path d="M13.5 22v-8.2H16l.4-3.2h-2.9V8.3c0-.9.3-1.6 1.6-1.6h1.8V3.8c-.3 0-1.3-.1-2.5-.1-2.5 0-4.1 1.5-4.1 4.2v2.3H8v3.2h2.3V22h3.2Z"/></svg>
          <div>
            <div class="link-title">Facebook</div>
            <div class="link-desc">@claudio.gemelli.fdi</div>
          </div>
        </a>
      </div>
      <p class="note">Suggerimento: aggiungi parametri UTM ai link per tracciare il traffico dal QR.</p>
    </section>

    <section class="section" aria-labelledby="docs-title">
      <h2 id="docs-title">Documenti</h2>
      <div class="docs" id="docs-list"><!-- Popolabili a mano o via JS --></div>
    </section>

    <section class="section" aria-labelledby="events-title">
      <h2 id="events-title">Eventi</h2>
      <div id="events-list" class="events"></div>
      <p class="note"><a href="./events.ics" download>Scarica il calendario (.ics)</a></p>
    </section>

    <section class="section" aria-labelledby="share-title">
      <h2 id="share-title">Condividi</h2>
      <div class="share" role="group" aria-label="Azioni di condivisione">
        <a id="share-wa" class="btn" href="#" target="_blank" rel="noopener" aria-label="Condividi su WhatsApp">WhatsApp</a>
        <a id="share-fb" class="btn" href="#" target="_blank" rel="noopener" aria-label="Condividi su Facebook">Facebook</a>
        <a id="share-ig" class="btn" href="#" target="_blank" rel="noopener" aria-label="Condividi su Instagram">Instagram</a>
        <button id="btn-share-native" class="btn" type="button" aria-label="Condividi">Condividi</button>
      </div>
      <div id="copy-toast" class="toast hidden" role="status" aria-live="polite">Link copiato negli appunti ✅</div>
    </section>

    <section class="section" aria-labelledby="extra-title">
      <h2 id="extra-title">Extra</h2>
      <div class="links">
        <a class="link-btn" href="#" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
          <div>
            <div class="link-title">Modulo contatti</div>
            <div class="link-desc">Collega un Google Form o Typeform</div>
          </div>
        </a>
        <a class="link-btn" href="#" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" aria-hidden="true" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="9"/><path d="M12 7v5l3 3"/></svg>
          <div>
            <div class="link-title">Calendario appuntamenti</div>
            <div class="link-desc">Linka Calendly o Google Calendar</div>
          </div>
        </a>
      </div>
    </section>

    <footer>
      <div class="contact">Contatti: <a href="mailto:votagemelli@gmail.com">votagemelli@gmail.com</a></div>
      <span class="badge">QR‑ready</span>
    </footer>
  </main>

  <script>
    // === Config ===
    const SITE_URL = (typeof window !== 'undefined' && window.location && window.location.href)
      ? window.location.href
      : 'https://votagemelli.github.io/links/';
    const ICS_URL = './events.ics';

    // === Last updated ===
    (function(){
      const t = document.getElementById('last-updated');
      if (!t) return;
      const d = new Date(document.lastModified);
      const fmt = new Intl.DateTimeFormat('it-IT', { dateStyle: 'long', timeStyle: 'short' });
      t.textContent = fmt.format(d);
      t.setAttribute('datetime', d.toISOString());
    })();

    // === Share buttons ===
    const text = 'Scopri il programma e gli eventi:';
    const aWa = document.getElementById('share-wa');
    const aFb = document.getElementById('share-fb');
    const aIg = document.getElementById('share-ig');
    const nat = document.getElementById('btn-share-native');
    const toast = document.getElementById('copy-toast');

    // Prepara gli href per i servizi di condivisione
    const waHref = 'https://wa.me/?text=' + encodeURIComponent(text + ' ' + SITE_URL);
    const fbHref = 'https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(SITE_URL);
    const igHref = 'https://www.instagram.com/'; // Instagram non supporta share URL con testo precompilato

    if (aWa) aWa.setAttribute('href', waHref);
    if (aFb) aFb.setAttribute('href', fbHref);
    if (aIg) aIg.setAttribute('href', igHref);

    function copyLink(){
      if (navigator.clipboard && navigator.clipboard.writeText) {
        return navigator.clipboard.writeText(SITE_URL).then(()=>{
          if (toast) { toast.classList.remove('hidden'); setTimeout(()=>toast.classList.add('hidden'), 1800); }
        });
      }
      const tmp = document.createElement('input');
      tmp.value = SITE_URL;
      document.body.appendChild(tmp);
      tmp.select();
      try { document.execCommand('copy'); } catch(e) {}
      document.body.removeChild(tmp);
      if (toast) { toast.classList.remove('hidden'); setTimeout(()=>toast.classList.add('hidden'), 1800); }
      return Promise.resolve();
    }

    // Instagram: prova condivisione nativa, altrimenti copia link e apri Instagram
    if (aIg) aIg.addEventListener('click', async (e)=>{
      if (navigator.share) {
        e.preventDefault();
        try {
          await navigator.share({ title: 'Vota Gemelli', text, url: SITE_URL });
          return;
        } catch (err) { /* fallback sotto */ }
      }
      // fallback: copia e poi apri Instagram in nuova scheda
      e.preventDefault();
      await copyLink();
      const w = window.open(igHref, '_blank');
      if (w) w.opener = null;
    });

    // Pulsante generico nativo
    if (nat) nat.addEventListener('click', async ()=>{
      if (navigator.share) {
        try { await navigator.share({ title: 'Vota Gemelli', text, url: SITE_URL }); return; } catch(e){}
      }
      await copyLink();
    });

    // === ICS parsing helpers ===
    function parseICSDate(v){
      if (!v) return null;
      // Support values like 20250120T173000Z, 20250120T173000, 20250120
      if (v.length === 16 && v.endsWith('Z') && v.indexOf('T') === 8) {
        return new Date(v.slice(0,4)+'-'+v.slice(4,6)+'-'+v.slice(6,8)+'T'+v.slice(9,11)+':'+v.slice(11,13)+':'+v.slice(13,15)+'Z');
      } else if (v.length === 15 && v.indexOf('T') === 8) {
        // treat as local time
        return new Date(v.slice(0,4)+'-'+v.slice(4,6)+'-'+v.slice(6,8)+'T'+v.slice(9,11)+':'+v.slice(11,13)+':'+v.slice(13,15));
      } else if (v.length === 8) {
        return new Date(v.slice(0,4)+'-'+v.slice(4,6)+'-'+v.slice(6,8));
      }
      return new Date(v);
    }

    function unfoldICS(text){
      // RFC 5545: a CRLF followed by space or tab indicates a folded (continued) line
      const norm = text.replace(/\r\n/g, '\n');
      return norm.replace(/\n[\t ]/g, '');
    }

    function unescapeICS(str){
      return String(str)
        .replace(/\\n/g, '\n')
        .replace(/\\,/g, ',')
        .replace(/\\;/g, ';');
    }

